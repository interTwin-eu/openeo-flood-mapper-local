<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Flood mapping with openEO - 2&nbsp; openEO remote processing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notebooks/references.html" rel="next">
<link href="../notebooks/1_yeoda_dc.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../notebooks/assets/styles/scroll.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/2_eodc_dc.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">openEO remote processing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Flood mapping with openEO</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/1_yeoda_dc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">openEO local processing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/2_eodc_dc.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">openEO remote processing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setting-up-a-python-session" id="toc-setting-up-a-python-session" class="nav-link active" data-scroll-target="#setting-up-a-python-session"><span class="header-section-number">2.1</span> Setting-up a Python session</a></li>
  <li><a href="#connect-to-the-eodc-openeo-backend" id="toc-connect-to-the-eodc-openeo-backend" class="nav-link" data-scroll-target="#connect-to-the-eodc-openeo-backend"><span class="header-section-number">2.2</span> Connect to the EODC openEO Backend</a></li>
  <li><a href="#load-collections-from-the-eodc" id="toc-load-collections-from-the-eodc" class="nav-link" data-scroll-target="#load-collections-from-the-eodc"><span class="header-section-number">2.3</span> Load Collections from the EODC</a></li>
  <li><a href="#openeo-analysis-at-the-eodc" id="toc-openeo-analysis-at-the-eodc" class="nav-link" data-scroll-target="#openeo-analysis-at-the-eodc"><span class="header-section-number">2.4</span> openEO Analysis at the EODC</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">openEO remote processing</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this second exercise we use the <a href="https://eodc.eu/">EODC</a> openEO service as our data source, and, more importantly, as our processing center.</p>
<section id="setting-up-a-python-session" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="setting-up-a-python-session"><span class="header-section-number">2.1</span> Setting-up a Python session</h2>
<p>We again begin by loading openEO and some additional packages.</p>
<div id="2c4a3e88" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openeo_flood_mapper_local.view_flood_map <span class="im">import</span> view_flood_map</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> openeo</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> openeo.processes <span class="im">import</span> ProcessBuilder, array_element, add, multiply, sin, cos, mask, exp, median</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connect-to-the-eodc-openeo-backend" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="connect-to-the-eodc-openeo-backend"><span class="header-section-number">2.2</span> Connect to the EODC openEO Backend</h2>
<p>Establish a connection to the EODC backend with <code>openeo.connect()</code>. This results in a connection object which is a critical aspect of collection discovery on the backend by openEO.</p>
<div id="2ab63e24" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>backend <span class="op">=</span> <span class="st">"https://openeo.eodc.eu"</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> openeo.<span class="ex">connect</span>(backend)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>connection.authenticate_oidc()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Authenticated using refresh token.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>&lt;Connection to 'https://openeo.eodc.eu/openeo/1.1.0/' with OidcBearerAuth&gt;</code></pre>
</div>
</div>
</section>
<section id="load-collections-from-the-eodc" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="load-collections-from-the-eodc"><span class="header-section-number">2.3</span> Load Collections from the EODC</h2>
<p>We can first have a look at the metadata available at the EODC for the required collections (SENTINEL1_SIG0_20M, SENTINEL1_HPAR, and SENTINEL1_MPLIA), like so:</p>
<div id="ae6d7050" class="cell output" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>connection.collection_metadata(<span class="st">"SENTINEL1_SIG0_20M"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

    <script>
    if (!window.customElements || !window.customElements.get('openeo-collection')) {
        var el = document.createElement('script');
        el.src = "https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js";
        document.head.appendChild(el);

        var font = document.createElement('font');
        font.as = "font";
        font.type = "font/woff2";
        font.crossOrigin = true;
        font.href = "https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2"
        document.head.appendChild(font);
    }
    </script>
    <openeo-collection>
        <script type="application/json">{"mapOptions": {}, "data": {"type": "Collection", "id": "SENTINEL1_SIG0_20M", "stac_version": "1.0.0", "description": "Sentinel-1 Sigma Nought (SIG0) Products are radiometric calibrated and georeferenced backscatter data generated from Sentinel-1 level-1 Interferometric Wide (IW) Swath Ground Range Detected (GRD) High resolution products using TUWien Sentinel-1 preprocesssing workflow. The preprocessing workflow includes following steps: applying precise orbit file, radiometric calibration, thermal noise removal, and range doppler terrain correction. In the end, Sigma0 backscatter image is reprojected and resampled into Equi7 Grid system at 20m pixels spacing.", "links": [{"rel": "items", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_SIG0_20M/items", "type": "application/geo+json"}, {"rel": "parent", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "root", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "self", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_SIG0_20M", "type": "application/json"}, {"rel": "items", "href": "https://dev.stac.eodc.eu/ingestion/v1/collections/SENTINEL1_SIG0_20M/items", "type": "application/geo+json"}], "stac_extensions": ["https://stac-extensions.github.io/sat/v1.0.0/schema.json", "https://stac-extensions.github.io/sar/v1.0.0/schema.json", "https://stac-extensions.github.io/eo/v1.0.0/schema.json", "https://stac-extensions.github.io/projection/v1.1.0/schema.json", "https://stac-extensions.github.io/item-assets/v1.0.0/schema.json", "https://stac-extensions.github.io/datacube/v2.0.0/schema.json"], "cube:dimensions": {"x": {"axis": "x", "type": "spatial", "extent": [-180, 180]}, "y": {"axis": "y", "type": "spatial", "extent": [-90, 90]}, "t": {"type": "temporal", "extent": [["2014-10-01T00:00:00Z", null]]}, "bands": {"type": "bands", "values": ["VV", "VH", "HH", "HV"]}}, "title": "SENTINEL1 Sigma Nought (SIG0) Backscatter in 20 meter resolution", "extent": {"spatial": {"bbox": [[-180, -90, 180, 90]]}, "temporal": {"interval": [["2014-10-01T00:00:00Z", null]]}}, "license": "proprietary", "providers": [{"name": "TU Wien", "roles": ["processor", "licensor"], "url": "https://www.tuwien.at/mg/geo"}, {"name": "EODC", "roles": ["processor", "host"], "url": "https://eodc.eu/"}], "summaries": {"gsd": [20], "eo:bands": [{"name": "VV", "common_name": "Sigma0_VV", "description": "Sigma Nought in VV polarization", "center_wavelength": 55465.76}, {"name": "VH", "common_name": "Sigma0_VH", "description": "Sigma Nought in VH polarization", "center_wavelength": 55465.76}, {"name": "HH", "common_name": "Sigma0_HH", "description": "Sigma Nought in HH polarization", "center_wavelength": 55465.76}, {"name": "HV", "common_name": "Sigma0_HV", "description": "Sigma Nought in HV polarization", "center_wavelength": 55465.76}], "platform": ["sentinel-1a", "sentinel-1b"], "item_assets": {"HH": {"type": "image/tiff; application=geotiff", "title": "Sigma Nought (HH)", "eo:bands": [{"name": "HH", "common_name": "Sigma0_HH", "center_wavelength": 55465.76}], "description": "Sigma Nought in HH polarization"}, "HV": {"type": "image/tiff; application=geotiff", "title": "Sigma Nought (HV)", "eo:bands": [{"name": "HV", "common_name": "Sigma0_HV", "center_wavelength": 55465.76}], "description": "Sigma Nought in HV polarization"}, "VH": {"type": "image/tiff; application=geotiff", "title": "Sigma Nought (VH)", "eo:bands": [{"name": "VH", "common_name": "Sigma0_VH", "center_wavelength": 55465.76}], "description": "Sigma Nought in VH polarization"}, "VV": {"type": "image/tiff; application=geotiff", "title": "Sigma Nought (VV)", "eo:bands": [{"name": "VV", "common_name": "Sigma0_VV", "center_wavelength": 55465.76}], "description": "Sigma Nought in VV polarization"}, "thumbnail": {"type": "image/png", "roles": ["thumbnail"], "title": "Thumbnail", "description": "A medium sized thumbnail"}}, "constellation": "sentinel-1"}}}</script>
    </openeo-collection>
    
</div>
</div>
<p>We can then load the collections. This is done by using the method <code>load_collection()</code> and by using the collection ids as defined above. During collection loading we also do some initial filtering on the spatial and temporal extent. More importantly, we have to filter SENTINEL1_MPLIA and SENTINEL1_HPAR for the descending orbit “D080” to be able to calculate the correct reference backscatter signatures. So, we use the following criteria for filtering.</p>
<div id="48d78dd3" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>spatial_extent <span class="op">=</span> {<span class="st">"west"</span>: <span class="fl">21.93</span>, <span class="st">"south"</span>: <span class="fl">39.47</span>, <span class="st">"east"</span>: <span class="fl">22.23</span>, <span class="st">"north"</span>: <span class="fl">39.64</span>}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sensing_date <span class="op">=</span> [<span class="st">"2018-02-28T04:00:00Z"</span>, <span class="st">"2018-02-28T05:00:00Z"</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>props <span class="op">=</span> {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"sat:orbit_state"</span>: <span class="kw">lambda</span> x: openeo.processes.eq(x, <span class="st">"descending"</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"sat:relative_orbit"</span>: <span class="kw">lambda</span> x: openeo.processes.eq(x, <span class="dv">80</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="09e8bf9b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sig0_dc <span class="op">=</span> connection.load_collection(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SENTINEL1_SIG0_20M"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    spatial_extent <span class="op">=</span> spatial_extent,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    temporal_extent <span class="op">=</span> sensing_date,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    bands<span class="op">=</span>[<span class="st">"VV"</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>). <span class="op">\</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    mean_time()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c3cbedd6" class="cell output" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>connection.collection_metadata(<span class="st">"SENTINEL1_HPAR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

    <script>
    if (!window.customElements || !window.customElements.get('openeo-collection')) {
        var el = document.createElement('script');
        el.src = "https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js";
        document.head.appendChild(el);

        var font = document.createElement('font');
        font.as = "font";
        font.type = "font/woff2";
        font.crossOrigin = true;
        font.href = "https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2"
        document.head.appendChild(font);
    }
    </script>
    <openeo-collection>
        <script type="application/json">{"mapOptions": {}, "data": {"type": "Collection", "id": "SENTINEL1_HPAR", "stac_version": "1.0.0", "description": "The Harmonic model describes the typical seasonal Sentinel-1 backscatter variation on a 20 m pixel level. It was designed as a smoothed time-series approximation, removing short-term perturbations, such as speckle and transient events (like floods for instance). Hence, the model is suited to discern the seasonal changes brought about by varying water content, e.g., inundation or soil moisture, and progression of vegetation structure.\nThe complete Sentinel-1 time-series dataset is challenging to analyse, primarily due to its sheer data volume of at the (global) scale of Petabytes. As a user-friendly alternative, this dataset provides a Harmonic (Fourier) series model that reduces the SAR backscatter seasonality to a relative small number of harmonic coefficient values. Seven coefficients computed using (harmonic) least squares regression, along with the standard deviation of residuals and number of observations, comprise the harmonic parametner set. The parameters are being operationally used to determine the expected SAR backscatter signal for any day of the year as part of the TU Wien's method contributing to GFM's ensemble flood monitoring effort (Bauer-Marschallinger et. al, 2022 https://www.mdpi.com/2072-4292/14/15/3673). The Global Harmonic Parameters (HPARs) were derived from the whole Sentinel-1 VV temporal stack for the period 2019-2020 by least squares regression with a harmonic model formulation, running three sinusoidal iterations (k=3).\nThis dataset was generated by the Remote Sensing Group of the TU Wien Department of Geodesy and Geoinformation,  within Framework Contract (No. 939866-IPR-2020) as part of the provision of an automated, global, satellite-based flood monitoring product for the Copernicus Emergency Management Service (CEMS) managed by the European Commission. The Global Flood Monitoring (GFM) product is integrated within the user interface of the Global Flood Awareness System (GloFAS) of the CEMS. ", "links": [{"rel": "items", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_HPAR/items", "type": "application/geo+json"}, {"rel": "parent", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "root", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "self", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_HPAR", "type": "application/json"}, {"rel": "items", "href": "https://dev.stac.eodc.eu/ingestion/v1/collections/SENTINEL1_HPAR/items", "type": "application/geo+json"}, {"rel": "items", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_HPAR/items", "type": "application/geo+json"}, {"rel": "license", "href": "https://creativecommons.org/licenses/by/4.0/legalcode", "type": "text/html", "title": "TUWien Harmonic Parameter Data License"}], "stac_extensions": ["https://stac-extensions.github.io/sat/v1.0.0/schema.json", "https://stac-extensions.github.io/sar/v1.0.0/schema.json", "https://stac-extensions.github.io/projection/v1.1.0/schema.json", "https://stac-extensions.github.io/datacube/v2.0.0/schema.json"], "cube:dimensions": {"x": {"axis": "x", "type": "spatial", "extent": [-180, 180]}, "y": {"axis": "y", "type": "spatial", "extent": [-90, 90]}, "t": {"type": "temporal", "extent": [["2019-01-01T00:00:00Z", "2021-12-31T00:00:00Z"]]}, "bands": {"type": "bands", "values": ["C1", "C2", "C3", "M0", "S1", "S2", "S3", "STD", "NOBS"]}}, "title": "SENTINEL1 Harmonic Parameters", "extent": {"spatial": {"bbox": [[-180, -90, 180, 90]]}, "temporal": {"interval": [["2019-01-01T00:00:00Z", "2021-12-31T00:00:00Z"]]}}, "license": "proprietary", "providers": [{"name": "TU Wien", "roles": ["processor", "licensor"], "url": "https://www.tuwien.at/mg/geo"}, {"name": "EODC", "roles": ["processor", "host"], "url": "https://eodc.eu/"}], "summaries": {"eo:bands": [{"name": "C1", "description": "Cosine component coefficient of iteration 1"}, {"name": "C2", "description": "Cosine component coefficient of iteration 2"}, {"name": "C3", "description": "Cosine component coefficient of iteration 3"}, {"name": "M0", "description": "Effective mean of the time series stacks, also called the harmonic residual in other literature."}, {"name": "S1", "description": "Sine component coefficient of iteration 1"}, {"name": "S2", "description": "Sine component coefficient of iteration 2"}, {"name": "S3", "description": "Sine component coefficient of iteration 3"}, {"name": "STD", "description": "Standard deviation of residuals, a proxy for model goodness of fit."}, {"name": "NOBS", "description": "Number of valid observations used for the least squares regression, also an indicator of solution quality."}], "platform": ["sentinel-1a", "sentinel-1b"], "constellation": "sentinel-1"}}}</script>
    </openeo-collection>
    
</div>
</div>
<div id="b578d3c5" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hparam_dc <span class="op">=</span> connection.load_collection(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SENTINEL1_HPAR"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    spatial_extent <span class="op">=</span> spatial_extent,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    temporal_extent <span class="op">=</span> <span class="st">"2019"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    properties<span class="op">=</span>props</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>). <span class="op">\</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    mean_time()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/mschobbe/miniconda3/envs/openeo-flood-mapper-local/lib/python3.10/site-packages/openeo/rest/connection.py:1188: UserWarning: SENTINEL1_HPAR property filtering with properties that are undefined in the collection metadata (summaries): sat:orbit_state, sat:relative_orbit.
  return DataCube.load_collection(</code></pre>
</div>
</div>
<div id="c78bc384" class="cell output" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>connection.collection_metadata(<span class="st">"SENTINEL1_MPLIA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

    <script>
    if (!window.customElements || !window.customElements.get('openeo-collection')) {
        var el = document.createElement('script');
        el.src = "https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js";
        document.head.appendChild(el);

        var font = document.createElement('font');
        font.as = "font";
        font.type = "font/woff2";
        font.crossOrigin = true;
        font.href = "https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2"
        document.head.appendChild(font);
    }
    </script>
    <openeo-collection>
        <script type="application/json">{"mapOptions": {}, "data": {"type": "Collection", "id": "SENTINEL1_MPLIA", "stac_version": "1.0.0", "description": "The projected local incidence angle (PLIA) is the angle between the surface normal and the looking direction of the satellite (local incidence angle - LIA) which is further projected into the range plane. It can be computed for each individual Sentinel-1 acquisition during the terrain correction using SNAP Sentinel-1 Toolbox. The PLIA for all Sentinel-1 GRDH scenes in the year 2020 have been proudced. Due to high accuracy and stability of Sentinel-1 orbit, the difference between PLIAs from different passes of the same relative orbit are neglectable, in particular for non-interferometry application. The PLIA are further aggregated to the mean PLIA per each relative orbit. \nThis colleciton includes global mean PLIA per relative orbit at 20 m sampling in Eqiu7 tiling system. The original data has been encoded by multiplying 100 and are stored in integer 16-bits data type in order to minimize file size.", "links": [{"rel": "items", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_MPLIA/items", "type": "application/geo+json"}, {"rel": "parent", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "root", "href": "https://dev.stac.eodc.eu/api/v1/", "type": "application/json"}, {"rel": "self", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_MPLIA", "type": "application/json"}, {"rel": "items", "href": "https://dev.stac.eodc.eu/ingestion/v1/collections/SENTINEL1_MPLIA/items", "type": "application/geo+json"}, {"rel": "items", "href": "https://dev.stac.eodc.eu/api/v1/collections/SENTINEL1_MPLIA/items", "type": "application/geo+json"}], "stac_extensions": ["https://stac-extensions.github.io/sat/v1.0.0/schema.json", "https://stac-extensions.github.io/sar/v1.0.0/schema.json", "https://stac-extensions.github.io/projection/v1.1.0/schema.json", "https://stac-extensions.github.io/datacube/v2.0.0/schema.json"], "cube:dimensions": {"x": {"axis": "x", "type": "spatial", "extent": [-180, 180]}, "y": {"axis": "y", "type": "spatial", "extent": [-90, 90]}, "t": {"type": "temporal", "extent": [["2020-01-01T00:00:00Z", "2020-12-31T00:00:00Z"]]}, "bands": {"type": "bands", "values": ["MPLIA", "NOBS"]}}, "title": "SENTINEL1 Mean PLIA", "extent": {"spatial": {"bbox": [[-180, -90, 180, 90]]}, "temporal": {"interval": [["2020-01-01T00:00:00Z", "2020-12-31T00:00:00Z"]]}}, "license": "proprietary", "providers": [{"name": "TU Wien", "roles": ["processor", "licensor"], "url": "https://www.tuwien.at/mg/geo"}, {"name": "EODC", "roles": ["processor", "host"], "url": "https://eodc.eu/"}], "summaries": {"eo:bands": [{"name": "MPLIA", "description": "The mean MPLIA of this orbit"}, {"name": "NOBS", "description": "Number of valid observations used Mean PLIA calculation."}], "platform": ["sentinel-1a", "sentinel-1b"], "constellation": "sentinel-1"}}}</script>
    </openeo-collection>
    
</div>
</div>
<div id="c071c0f5" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plia_dc <span class="op">=</span> connection.load_collection(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SENTINEL1_MPLIA"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    spatial_extent <span class="op">=</span> spatial_extent,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    temporal_extent <span class="op">=</span> [<span class="st">"2020-01-01"</span>, <span class="st">"2020-12-31"</span>],</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    bands<span class="op">=</span>[<span class="st">"MPLIA"</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    properties<span class="op">=</span>props</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>). <span class="op">\</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    mean_time()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/mschobbe/miniconda3/envs/openeo-flood-mapper-local/lib/python3.10/site-packages/openeo/rest/connection.py:1188: UserWarning: SENTINEL1_MPLIA property filtering with properties that are undefined in the collection metadata (summaries): sat:orbit_state, sat:relative_orbit.
  return DataCube.load_collection(</code></pre>
</div>
</div>
</section>
<section id="openeo-analysis-at-the-eodc" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="openeo-analysis-at-the-eodc"><span class="header-section-number">2.4</span> openEO Analysis at the EODC</h2>
<p>The remainder of the worklfow is similar to the local processing with some minor differences associated to naming of the objects.</p>
<div id="1937ae5f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> water_backscatter(plia_dc):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (plia_dc.band(<span class="st">'MPLIA'</span>) <span class="op">*</span> <span class="op">-</span><span class="fl">0.394181</span> <span class="op">+</span> <span class="op">-</span><span class="fl">4.142015</span>). <span class="op">\</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        add_dimension(<span class="st">'bands'</span>, <span class="st">'wbsc'</span>, <span class="st">'bands'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we apply again the <code>water_backscatter()</code> function to the incidence angle datacube, as follows:</p>
<div id="208e39c2" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>water_bsc_dc <span class="op">=</span> water_backscatter(plia_dc)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>water_bsc_dc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

    <script>
    if (!window.customElements || !window.customElements.get('openeo-model-builder')) {
        var el = document.createElement('script');
        el.src = "https://cdn.jsdelivr.net/npm/@openeo/vue-components@2/assets/openeo.min.js";
        document.head.appendChild(el);

        var font = document.createElement('font');
        font.as = "font";
        font.type = "font/woff2";
        font.crossOrigin = true;
        font.href = "https://use.fontawesome.com/releases/v5.13.0/webfonts/fa-solid-900.woff2"
        document.head.appendChild(font);
    }
    </script>
    <openeo-model-builder>
        <script type="application/json">{"id": "04f5e9f135d54b0397501555f2acdfb2", "explicit-zoom": true, "height": "400px", "value": {"process_graph": {"loadcollection1": {"process_id": "load_collection", "arguments": {"bands": ["MPLIA"], "id": "SENTINEL1_MPLIA", "properties": {"sat:orbit_state": {"process_graph": {"eq1": {"process_id": "eq", "arguments": {"x": {"from_parameter": "value"}, "y": "descending"}, "result": true}}}, "sat:relative_orbit": {"process_graph": {"eq2": {"process_id": "eq", "arguments": {"x": {"from_parameter": "value"}, "y": 80}, "result": true}}}}, "spatial_extent": {"west": 21.93, "south": 39.47, "east": 22.23, "north": 39.64}, "temporal_extent": ["2020-01-01", "2020-12-31"]}}, "reducedimension1": {"process_id": "reduce_dimension", "arguments": {"data": {"from_node": "loadcollection1"}, "dimension": "t", "reducer": {"process_graph": {"mean1": {"process_id": "mean", "arguments": {"data": {"from_parameter": "data"}}, "result": true}}}}}, "reducedimension2": {"process_id": "reduce_dimension", "arguments": {"data": {"from_node": "reducedimension1"}, "dimension": "bands", "reducer": {"process_graph": {"arrayelement1": {"process_id": "array_element", "arguments": {"data": {"from_parameter": "data"}, "index": 0}}, "multiply1": {"process_id": "multiply", "arguments": {"x": {"from_node": "arrayelement1"}, "y": -0.394181}}, "add1": {"process_id": "add", "arguments": {"x": {"from_node": "multiply1"}, "y": -4.142015}, "result": true}}}}}, "adddimension1": {"process_id": "add_dimension", "arguments": {"data": {"from_node": "reducedimension2"}, "label": "wbsc", "name": "bands", "type": "bands"}, "result": true}}}}</script>
    </openeo-model-builder>
    
</div>
</div>
<p>To initiate the processing we create a batch job with the <code>create_job()</code> method. This performs the data processing based on the JSON representation of the processing graph. Only by submitting this job to the EODC backend, we can actually perform the processing, like so:</p>
<div id="8eccc86a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>water_bsc_res <span class="op">=</span> water_bsc_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>water_bsc_job <span class="op">=</span> water_bsc_res.create_job(title <span class="op">=</span> <span class="st">"water_bsc_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>water_bsc_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then download the results.</p>
<div id="a1989f34" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>water_bsc_job.download_result(<span class="st">"data/watter_backscatter/example.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And view the retrieved data.</p>
<div id="0aa5194d" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>water_bsc_dc <span class="op">=</span> xr.open_dataset(<span class="st">"data/watter_backscatter/example.nc"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>water_bsc_dc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code is a duplicate of the local flood mapping processing pipeline, where we define the harmonic model.</p>
<div id="def8260e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> harmonic_expected_backscatter(data, dtime_str):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> np.pi <span class="op">*</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> datetime.strptime(dtime_str, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> dt.timetuple().tm_yday</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    wt <span class="op">=</span> w <span class="op">*</span> t</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    M0 <span class="op">=</span> data.band(<span class="st">'M0'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    S1 <span class="op">=</span> data.band(<span class="st">'S1'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    S2 <span class="op">=</span> data.band(<span class="st">'S2'</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    S3 <span class="op">=</span> data.band(<span class="st">'S3'</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    C1 <span class="op">=</span> data.band(<span class="st">'C1'</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    C2 <span class="op">=</span> data.band(<span class="st">'C2'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    C3 <span class="op">=</span> data.band(<span class="st">'C3'</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    hm_c1 <span class="op">=</span> (M0 <span class="op">+</span> S1 <span class="op">*</span> np.sin(wt)) <span class="op">+</span> (C1 <span class="op">*</span> np.cos(wt))</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    hm_c2 <span class="op">=</span> ((hm_c1 <span class="op">+</span> S2 <span class="op">*</span> np.sin(<span class="dv">2</span> <span class="op">*</span> wt)) <span class="op">+</span> C2 <span class="op">*</span> np.cos(<span class="dv">2</span> <span class="op">*</span> wt))</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    hm_c3 <span class="op">=</span> ((hm_c2 <span class="op">+</span> S3 <span class="op">*</span> np.sin(<span class="dv">3</span> <span class="op">*</span> wt)) <span class="op">+</span> C3 <span class="op">*</span> np.cos(<span class="dv">3</span> <span class="op">*</span> wt))</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> hm_c3.add_dimension(<span class="st">'bands'</span>, <span class="st">'hbsc'</span>, <span class="st">'bands'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perform this function on the datacube for the time slice of the flooding event.</p>
<div id="00a60e04" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>land_bsc_dc <span class="op">=</span> harmonic_expected_backscatter(hparam_dc, <span class="st">'2018-02-01'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In turn, we define the Bayesian classification model, as follows:</p>
<div id="2f34c0a3" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bayesian_flood_decision(x: ProcessBuilder) <span class="op">-&gt;</span> ProcessBuilder:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    nf_std <span class="op">=</span> <span class="fl">2.754041</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    sig0 <span class="op">=</span> x.array_element(index<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    std <span class="op">=</span> x.array_element(index<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    wbsc <span class="op">=</span> x.array_element(index<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    hbsc <span class="op">=</span> x.array_element(index<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    f_prob <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">/</span> (std <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi))) <span class="op">*</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="op">\</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        (((sig0 <span class="op">-</span> wbsc) <span class="op">/</span> nf_std) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    nf_prob <span class="op">=</span> (<span class="fl">1.0</span> <span class="op">/</span> (nf_std <span class="op">*</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> np.pi))) <span class="op">*</span> np.exp(<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="op">\</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        (((sig0 <span class="op">-</span> hbsc) <span class="op">/</span> nf_std) <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    evidence <span class="op">=</span> (nf_prob <span class="op">*</span> <span class="fl">0.5</span>) <span class="op">+</span> (f_prob <span class="op">*</span> <span class="fl">0.5</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    f_post_prob <span class="op">=</span> (f_prob <span class="op">*</span> <span class="fl">0.5</span>) <span class="op">/</span> evidence </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    nf_post_prob <span class="op">=</span> (nf_prob <span class="op">*</span> <span class="fl">0.5</span>) <span class="op">/</span> evidence </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># flood if flood class has higher probability</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> f_post_prob.gt(nf_post_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then execute this on a combined data cube, as follows:</p>
<div id="63cd2807" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>std_dc <span class="op">=</span> hparam_dc.band(<span class="st">'STD'</span>).add_dimension(<span class="st">'bands'</span>, <span class="st">'std'</span>, <span class="st">'bands'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sig0_dc <span class="op">=</span> sig0_dc.reduce_bands(<span class="st">'mean'</span>).add_dimension(<span class="st">'bands'</span>, <span class="st">'sig0'</span>, <span class="st">'bands'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>decision_in_dc <span class="op">=</span> sig0_dc. <span class="op">\</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    merge_cubes(std_dc). <span class="op">\</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    merge_cubes(water_bsc_dc). <span class="op">\</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    merge_cubes(land_bsc_dc) . <span class="op">\</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    merge_cubes(plia_dc)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> decision_in_dc.reduce_bands(bayesian_flood_decision). <span class="op">\</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    add_dimension(<span class="st">'bands'</span>, <span class="st">'dec'</span>, <span class="st">'bands'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> flood_dc.merge_cubes(decision_in_dc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can again proceed and send this processing pipeline of to the EODC.</p>
<div id="3c76fa46" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>flood_res <span class="op">=</span> flood_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>flood_job <span class="op">=</span> flood_res.create_job(title <span class="op">=</span> <span class="st">"flood_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>flood_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And retrieve the data, like so:</p>
<div id="4c2381cd" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>flood_job.download_result(<span class="st">"data/thessaly_floodmap.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s have a look at the processing job performed at EODC.</p>
<div id="b1330225" class="cell" data-results="hide" data-execution_count="22">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>view_flood_map(xr.open_dataset(<span class="st">"data/thessaly_floodmap.nc"</span>).dec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_eodc_dc_files/figure-html/cell-23-output-1.png" width="814" height="634" class="figure-img"></p>
<figcaption>openEO floodmap - no pre-processing</figcaption>
</figure>
</div>
</div>
</div>
<p>We can than also again extend this pipeline to include the postprocessing steps.</p>
<ol type="1">
<li>Masking of Exceeding Incidence Angles</li>
</ol>
<div id="3e946693" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mask_ia <span class="op">=</span> (flood_dc.band(<span class="st">"MPLIA"</span>) <span class="op">&gt;=</span> <span class="dv">27</span>) <span class="op">*</span> (flood_dc.band(<span class="st">"MPLIA"</span>) <span class="op">&lt;=</span> <span class="dv">48</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> flood_dc <span class="op">*</span> mask_ia</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c2957be3" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>flood_res <span class="op">=</span> flood_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>flood_job <span class="op">=</span> flood_res.create_job(title <span class="op">=</span> <span class="st">"flood_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>flood_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d5c37c7d" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>flood_job.download_result(<span class="st">"data/thessaly_floodmap_plia.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="40c2d51b" class="cell" data-results="hide" data-execution_count="26">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_eodc_dc_files/figure-html/cell-27-output-1.png" width="814" height="634" class="figure-img"></p>
<figcaption>openEO floodmap - masking exceeding incidence angles</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Identification of Conflicting Distributions</li>
</ol>
<div id="0599a714" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>water_bsc_threshold <span class="op">=</span> flood_dc.band(<span class="st">"wbsc"</span>) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fl">2.754041</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mask_conflict <span class="op">=</span> flood_dc.band(<span class="st">"hbsc"</span>) <span class="op">&gt;</span> water_bsc_threshold</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> flood_dc <span class="op">*</span> mask_conflict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="47cdc6c6" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>flood_res <span class="op">=</span> flood_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>flood_job <span class="op">=</span> flood_res.create_job(title <span class="op">=</span> <span class="st">"flood_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>flood_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="91f08f46" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>flood_job.download_result(<span class="st">"data/thessaly_floodmap_plia_distr.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="91262272" class="cell" data-results="hide" data-execution_count="30">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_eodc_dc_files/figure-html/cell-31-output-1.png" width="814" height="634" class="figure-img"></p>
<figcaption>openEO floodmap - masking conflicting distributions + exceeding incidence angles</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Removal of Measurement Outliers</li>
</ol>
<div id="08f0cf09" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>land_bsc_lower <span class="op">=</span> flood_dc.band(<span class="st">"hbsc"</span>) <span class="op">-</span> <span class="dv">3</span> <span class="op">*</span> flood_dc.band(<span class="st">"std"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>land_bsc_upper <span class="op">=</span> flood_dc.band(<span class="st">"hbsc"</span>) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> flood_dc.band(<span class="st">"std"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>water_bsc_upper <span class="op">=</span> flood_dc.band(<span class="st">"wbsc"</span>) <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> <span class="fl">2.754041</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>mask_land_outliers <span class="op">=</span> (flood_dc.band(<span class="st">"sig0"</span>) <span class="op">&gt;</span> land_bsc_lower) <span class="op">*</span> (flood_dc.band(<span class="st">"sig0"</span>) <span class="op">&lt;</span> land_bsc_upper)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>mask_water_outliers <span class="op">=</span> flood_dc.band(<span class="st">"sig0"</span>) <span class="op">&lt;</span> water_bsc_upper</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> flood_dc <span class="op">*</span> (mask_land_outliers <span class="op">|</span> mask_water_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="da900289" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>flood_res <span class="op">=</span> flood_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>flood_job <span class="op">=</span> flood_res.create_job(title <span class="op">=</span> <span class="st">"flood_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>flood_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="7bd73aa4" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>flood_job.download_result(<span class="st">"data/thessaly_floodmap_plia_distr_out.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="d8285b74" class="cell" data-results="hide" data-execution_count="34">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_eodc_dc_files/figure-html/cell-35-output-1.png" width="814" height="634" class="figure-img"></p>
<figcaption>openEO floodmap - masking extreme outliers + conflicting distributions + exceeding incidence angles</figcaption>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Denial of High Uncertainty on Decision</li>
</ol>
<div id="b128aff1" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mask_uncertainty <span class="op">=</span> flood_dc.band(<span class="st">"dec"</span>) <span class="op">&gt;</span> <span class="fl">0.8</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>flood_dc <span class="op">=</span> flood_dc <span class="op">*</span> mask_uncertainty</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="0f8bbaea" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>flood_res <span class="op">=</span> flood_dc.save_result(<span class="bu">format</span> <span class="op">=</span> <span class="st">"NetCDF"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>flood_job <span class="op">=</span> flood_res.create_job(title <span class="op">=</span> <span class="st">"flood_greece_flood_2018_as_NetCDF_py"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>flood_job.start_job()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="979f97ea" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>flood_job.download_result(<span class="st">"data/thessaly_floodmap_plia_distr_out_den.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="a06ac211" class="cell" data-results="hide" data-execution_count="38">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2_eodc_dc_files/figure-html/cell-39-output-1.png" width="814" height="634" class="figure-img"></p>
<figcaption>openEO floodmap - masking high uncertainty classifications + extreme outliers + conflicting distributions + exceeding incidence angles</figcaption>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notebooks/1_yeoda_dc.html" class="pagination-link  aria-label=" &lt;span="" local="" processing&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">openEO local processing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notebooks/references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>